<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pendaftaran Anggota GOPAN</title>
  <style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;600&display=swap');

  body {
    font-family: 'Poppins', sans-serif;
    margin:0; padding:0;
    background:#f5f9ff;
    color:#333;
    line-height:1.6;
  }

  /* ===== CONTAINER GLOBAL ===== */
  .container {
    max-width: 1200px;
    margin: auto;
    padding: 0 20px;
  }

  /* ===== HEADER ===== */
  header {
    background: linear-gradient(135deg, #003f80, #4fa3ff);
    padding:25px 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    width: 100%;
  }
  .header-top {
    display:flex; align-items:center; justify-content:center;
    gap:20px; flex-wrap:wrap; text-align:center;
  }
  .header-logo {
    width:80px; border-radius:14px;
    box-shadow:0 4px 12px rgba(0,63,128,0.4);
  }
  .header-title h1 {
    font-family:'Playfair Display', serif;
    font-size:2rem; margin:0;
    color:#fff;
  }
  .header-title span { color:#ffd700; }
  .header-title p { color:#eef6ff; margin:6px 0 0; font-size:1rem; }

  /* ===== SECTION TITLE ===== */
  .section-title {
    text-align:center;
    margin:0 0 25px;
    color:#003f80;
    font-weight:700;
    font-size:1.6rem;
  }

  /* ===== FORM ===== */
  .form-section { padding:40px 0; }
  form#anggotaForm {
    background:#fff;
    padding:30px; border-radius:16px;
    box-shadow:0 6px 18px rgba(0,0,0,0.08);
  }
  .form-group { margin-bottom:18px; }
  label { font-weight:600; color:#003f80; display:block; margin-bottom:6px; }
  input, select {
    width:100%; padding:12px 14px;
    border-radius:10px; border:1px solid #ccd9e6;
    font-size:0.95rem; outline:none;
  }
  input:focus, select:focus {
    border-color:#4fa3ff; box-shadow:0 0 4px rgba(79,163,255,0.4);
  }
  .kandang-group {
    padding:16px; border:1px solid #e0e9f5;
    border-radius:12px; margin-bottom:16px;
    background:#f9fbff;
    position:relative;
  }
  .removeKandang {
    position:absolute; top:10px; right:10px;
    padding:5px 10px; border:none; border-radius:6px;
    background:#ff4d4d; color:#fff; cursor:pointer;
    font-size:0.8rem;
  }
  .removeKandang:hover { background:#cc0000; }

  .form-row {
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap:16px;
  }

  .form-actions {
    display:flex; justify-content:flex-end;
    margin-top:20px; gap:12px; flex-wrap:wrap;
  }
  .addBtn, .submit {
    padding:14px 20px;
    border:none; border-radius:10px;
    cursor:pointer; font-weight:600; font-size:1rem;
    transition:0.3s;
  }
  .addBtn { background:#4fa3ff; color:#fff; }
  .addBtn:hover { background:#1a73e8; }
  .submit {
    background:linear-gradient(135deg,#003f80,#4fa3ff);
    color:#fff;
  }
  .submit:hover { opacity:0.9; }

  /* ===== TABLE ===== */
  .table-section { padding:40px 0; }
  .table-wrapper { 
    overflow-x:auto; 
    border-radius:12px; 
    box-shadow:0 4px 15px rgba(0,0,0,0.06); 
  }
  table {
    width:100%; border-collapse:collapse;
    background:#fff; border-radius:12px; overflow:hidden;
  }
  th {
    background:#003f80;
    color:#fff; padding:14px; text-align:left; font-weight:600;
    white-space: nowrap;
  }
  td {
    padding:14px; border-bottom:1px solid #eee;
    word-wrap: break-word;
    max-width: 200px;
  }
  tr:nth-child(even) { background:#f8fbff; }
  tr:hover { background:#edf5ff; }
  .table-title {
    margin-bottom:16px;
    color:#003f80; font-weight:700;
    font-size:1.5rem;
    text-align: center;
  }

  /* ===== STATUS COLORS ===== */
  .statusPending { color:#ffc107; font-weight:600; }
  .statusDiterima { color:#28a745; font-weight:600; }
  .statusDitolak { color:#dc3545; font-weight:600; }

  /* ===== RESPONSIVE ===== */
  @media (max-width:768px) {
    .header-title h1 { font-size:1.5rem; }
    form#anggotaForm { padding:20px; }
    .form-row { grid-template-columns:1fr; }
    .form-actions { justify-content:center; }
    table { font-size:0.9rem; }
    td { max-width:120px; }
  }
  @media (max-width:576px) {
    .header-logo { width:60px; }
    .header-title h1 { font-size:1.2rem; }
    .header-title p { font-size:0.8rem; }
    table { font-size:0.8rem; }
    td { max-width:100px; }
  }
  </style>
</head>
<body>

<header>
  <div class="container">
    <div class="header-top">
      <img src="img/gopan-pengaduan.jpg" alt="Logo GOPAN" class="header-logo">
      <div class="header-title">
        <h1>Pendaftaran Anggota <span>GOPAN</span></h1>
        <p>Bergabung bersama, majukan peternakan rakyat</p>
      </div>
    </div>
  </div>
</header>

<div class="container">
  <section class="form-section">
    <form id="anggotaForm">
      <h2 class="section-title">Form Pendaftaran Anggota</h2>
      <div class="form-group">
        <label for="nama">Nama Lengkap</label>
        <input type="text" id="nama" placeholder="Masukkan nama lengkap" required>
      </div>
      <div class="form-group">
        <label for="hp">No HP</label>
        <input type="tel" id="hp" placeholder="10-13 digit nomor HP" required>
      </div>
      <div id="kandangContainer">
        <div class="kandang-group">
          <div class="form-row">
            <div>
              <label>Domisili Kandang</label>
              <input type="text" class="domisili" placeholder="Masukkan domisili kandang" required>
            </div>
            <div>
              <label>Populasi</label>
              <input type="number" class="populasi" placeholder="Jumlah populasi" min="1" required>
            </div>
            <div>
              <label>Status Kandang</label>
              <select class="statusKandang" required>
                <option value="">-- Pilih Status --</option>
                <option value="sendiri">Sendiri</option>
                <option value="sewa">Sewa</option>
              </select>
            </div>
          </div>
          <button type="button" class="removeKandang">❌ Hapus</button>
        </div>
      </div>
      <div class="form-actions">
        <button type="button" class="addBtn" onclick="addKandang()">➕ Tambah Kandang</button>
        <button type="submit" class="submit">✨ Daftar Sekarang ✨</button>
      </div>
    </form>
  </section>

  <section class="table-section">
    <h2 class="table-title">Daftar Anggota</h2>
    <div class="table-wrapper">
      <table id="anggotaTable">
        <thead>
          <tr>
            <th>Nama</th>
            <th>No HP</th>
            <th>Domisili Kandang</th>
            <th>Populasi</th>
            <th>Status Kandang</th>
            <th>Status Anggota</th>
          </tr>
        </thead>
        <tbody id="anggotaTableBody">
          <tr>
            <td>Andi Pratama</td>
            <td>08123456789</td>
            <td>Bali</td>
            <td>200</td>
            <td>Sendiri</td>
            <td class="statusPending">Pending</td>
          </tr>
          <tr>
            <td>Siti Aminah</td>
            <td>082233445566</td>
            <td>Jakarta</td>
            <td>120</td>
            <td>Sewa</td>
            <td class="statusDiterima">Diterima</td>
          </tr>
          <tr>
            <td>Budi Santoso</td>
            <td>08987654321</td>
            <td>Bandung</td>
            <td>90</td>
            <td>Sendiri</td>
            <td class="statusDitolak">Ditolak</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>

</body>
</html>

<script>
// ===== SIMULASI LOGIN =====
const currentUser = { id: 1, role: 'admin' };

// ===== TAMBAH KANDANG =====
const kandangContainer = document.getElementById('kandangContainer');
const addKandangBtn = document.querySelector('.addBtn'); // tombol tambah kandang

function addKandang(){
  const div = document.createElement('div');
  div.className = 'kandang-group';
  div.innerHTML = `
    <label>Domisili Kandang</label>
    <input type="text" class="domisili" placeholder="Masukkan domisili kandang" required>
    <label>Populasi</label>
    <input type="number" class="populasi" placeholder="Jumlah populasi" min="1" required>
    <label>Status Kandang</label>
    <select class="statusKandang" required>
      <option value="">-- Pilih Status --</option>
      <option value="sendiri">Sendiri</option>
      <option value="sewa">Sewa</option>
    </select>
    <button type="button" class="removeKandang">❌ Hapus Kandang</button>
  `;
  kandangContainer.appendChild(div);
}

// Klik tombol hapus kandang
kandangContainer.addEventListener('click', e=>{
  if(e.target.classList.contains('removeKandang')){
    e.target.parentElement.remove();
  }
});

// Klik tombol tambah kandang
addKandangBtn.addEventListener('click', addKandang);

// ===== FORM SUBMIT =====
const anggotaForm = document.getElementById('anggotaForm');

anggotaForm.addEventListener('submit', e=>{
  e.preventDefault();

  const nama = document.getElementById('nama').value.trim();
  const hp = document.getElementById('hp').value.trim();
  const kandangs = [];
  let valid = true;

  document.querySelectorAll('#kandangContainer .kandang-group').forEach(g=>{
    const domisili = g.querySelector('.domisili').value.trim();
    const populasi = parseInt(g.querySelector('.populasi').value) || 0;
    const status = g.querySelector('.statusKandang').value;
    if(!domisili || !populasi || !status){
      alert('Isi semua field kandang!');
      valid = false;
      return;
    }
    kandangs.push({domisili, populasi, status});
  });

  if(!valid) return;

  fetch('api.php?action=create', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      nama, hp, kandang: kandangs,
      statusAnggota: 'Pending', alasan: '',
      createdBy: currentUser.id
    })
  })
  .then(res=>res.json())
  .then(res=>{
    if(res.success){
      resetForm();
      loadTableFromDB();
      alert('Data berhasil disimpan ke MySQL!');
    } else {
      alert('Gagal menyimpan: ' + res.error);
    }
  })
  .catch(err=>console.error(err));
});

// ===== RESET FORM =====
function resetForm(){
  anggotaForm.reset();
  kandangContainer.innerHTML = '';
  addKandang();
}

// ===== TABEL =====
const anggotaTableBody = document.getElementById('anggotaTableBody');

function loadTableFromDB(){
  fetch('api.php?action=read')
  .then(res=>res.json())
  .then(list=>{
    anggotaTableBody.innerHTML = '';
    list.forEach(item=>{
      const domisiliStr = item.kandang.map(k=>k.domisili).join(', ');
      const populasiStr = item.kandang.map(k=>k.populasi).join(', ');
      const statusStr = item.kandang.map(k=>k.status).join(', ');

      const statusClass = item.statusAnggota==='Diterima'?'statusDiterima':
                          item.statusAnggota==='Ditolak'?'statusDitolak':'statusPending';

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.nama}</td>
        <td>${item.hp}</td>
        <td>${domisiliStr}</td>
        <td>${populasiStr}</td>
        <td>${statusStr}</td>
        <td class="${statusClass}">${item.statusAnggota}</td>
      `;
      anggotaTableBody.appendChild(tr);
    });
  });
}

// ===== INIT =====
document.addEventListener('DOMContentLoaded', ()=>{
  resetForm();
  loadTableFromDB();
});
</script>


</body>
</html>
